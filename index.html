<html>

<head>
    <title>Photon</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/photon.min.css">

    <!-- Javascript -->
    <script>
        if (typeof module === 'object') {
            window.module = module;
            module = undefined;
        }
    </script>
    <script>
        var rpc = require('node-json-rpc');
        var d3 = require('d3');
        var $ = jquery = require('jquery')
    </script>
    <script>
        if (window.module) module = window.module;
    </script>

    <script src="js/menu.js" charset="utf-8"></script>
    <script src="js/branch.js" charset="utf-8"></script>
</head>

<body>
    <div class="window">
        <header class="toolbar toolbar-header">
            <h1 class="title">Branch Predict</h1>
        </header>
        <div class="window-content">
            <div class="pane-group">
                <div class="pane pane-sm sidebar">
                    <input type="button" value="list" onclick="listgenes()">
                    </input>
                    <input type="button" value="predict" onclick="predict('CTGTATTTAAGTCTCCGGGGGCTGGGGGAATCAGGGTTTCCCACCAACCACCCTCACTCAGCCTTTTCCCTCCAG')">
                    </input>
                    <input type="button" value="introns" onclick="introns('STAT1')">

                    </input>
                </div>
                <div class="pane">
                    <svg style="height:500px;width:700px">
                </svg>
                </div>
            </div>
        </div>
        <footer class="toolbar toolbar-footer">
            <h1 class="title">Footer</h1>
        </footer>
    </div>

</body>
<script>
    var options = {
        port: 7000,
        host: '127.0.0.1',
        path: '/',
        strict: true
    };
    var client = new rpc.Client(options);
    console.log(client)

    function listgenes() {
        client.call({
                "jsonrpc": "2.0",
                "method": "list",
                "params": [],
                "id": "listgene"
            },
            function(err, res2) {
                if (err) {
                    console.log("error", err);
                } else {
                    console.log(res2)
                }
            });
    }
    var chart = branch.chart();

    function predict(d) {
        client.call({
            "jsonrpc": "2.0",
            "method": "branch",
            "params": [d],
            "id": "predict"

        }, function(err, res2) {
            if (err) {
                console.log("error", err)
            } else {
                res2.seq = d;
                console.log("predict result", res2)
                d3.select("svg").append("g").datum(res2).attr("transform", "translate(40,20)").call(chart);

            }
        })
    }

    function introns(d) {
        client.call({
            "jsonrpc": "2.0",
            "method": "introns",
            "params": [d],
            "id": "introns"

        }, function(err, res2) {
            if (err) {
                console.log("error", err)
            } else {
                console.log(res2)
                res2.result.forEach(function(d) {
                    branch.getseq(d, function(d0) {
                        d0.seq = d0.seq.toUpperCase()
                        predict(d0.seq.toUpperCase())
                    })
                })

            }
        })
    }
</script>

</html>
